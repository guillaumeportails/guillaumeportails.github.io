var firstfly,flownTo,ttMilestone,lgPlaces,control,zanim;function getParameterByName(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var d=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),c=d.exec(b);return c?c[2]?decodeURIComponent(c[2].replace(/\+/g," ")):'':null}function addslashes(a){return(a+'').replace(/[\\"']/g,'\\$&').replace(/\u0000/g,'\\0')}const Zoom2Mile=[1e3,1e3,1e3,1e3,1e3,500,200,100,50,20,10,5,5,2,1,1,1,1,1,1,1,1,1,1,1,1],tilesWatercolor=new L.TileLayer('http://tile.stamen.com/watercolor/{z}/{x}/{y}.jpg',{maxZoom:17,attribution:'Stamen.com, Sourced from LINZ. CC-BY 3.0'}),tilesToner=new L.TileLayer('http://tile.stamen.com/toner/{z}/{x}/{y}.png',{maxZoom:15,attribution:'Stamen.com, Sourced from LINZ. CC-BY 3.0'}),tilesTerrain=L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.{ext}',{maxZoom:18,attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:'abcd',ext:'png'}),tilesOSM=new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,subdomains:'abc',attribution:'OpenStreetMap. CC-BY 3.0'}),tilesOTM=new L.TileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',{maxZoom:17,subdomains:'abc',attribution:'&copy; <a href="http://opentopomap.org/credits">OpenTopoMap</a> CC-BY-SA'}),tilesUSGS=L.tileLayer('https://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer/tile/{z}/{y}/{x}',{maxZoom:16,attribution:'Tiles courtesy of the <a href="https://usgs.gov/">U.S. Geological Survey</a>'}),tilesUSGSimageryTopo=L.tileLayer('https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryTopo/MapServer/tile/{z}/{y}/{x}',{maxZoom:16,attribution:'Tiles courtesy of the <a href="https://usgs.gov/">U.S. Geological Survey</a>'}),tilesOutdoors=new L.TileLayer('https://{s}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey=d2842e9679314b55a9c0a84e94961f0e',{maxZoom:17,subdomains:'ab',attribution:'<a href="https://www.thunderforest.com">Thunderforest, CC-BY 3.0</a>'}),tilesHikeBike=new L.TileLayer('http://{s}.tiles.wmflabs.org/hikebike/{z}/{x}/{y}.png',{maxZoom:17,subdomains:'abc',attribution:'<a href="https://www.thunderforest.com">Thunderforest, CC-BY 3.0</a>'}),tilesDelorme=new L.TileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/Specialty/DeLorme_World_Base_Map/MapServer/tile/{z}/{y}/{x}',{minZoom:1,maxZoom:11,attribution:'Tiles &copy; Esri &mdash; Copyright: &copy;2012 DeLorme'}),tilesWorldStreets=L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}',{attribution:'Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012'}),tilesImagery=L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{attribution:'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'}),tilesKorona=new L.TileLayer('http://korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}',{minZoom:1,maxZoom:18,attribution:'Tiles &copy; Korona Uni-Heidelberg'}),tilesLocal=new L.TileLayer('http://localhost:3000/tiles/{z}/{x}/{y}.png',{maxZoom:19,attribution:'OSM, LINZ, et al., CC-BY-SA'}),basemaps={OSM:tilesOSM,'OTM (m)':tilesOTM,'USGS (ft)':tilesUSGS,'USGS imagery':tilesUSGSimageryTopo,'Outdoors (m)':tilesOutdoors,DeLorme:tilesDelorme,WorldStreets:tilesWorldStreets,watercolor:tilesWatercolor,toner:tilesToner,terrain:tilesTerrain,imagery:tilesImagery},tilesWayMarkedTrails=new L.TileLayer('https://tile.waymarkedtrails.org/hiking/{z}/{x}/{y}.png',{maxZoom:18,attribution:'<a href="hiking.waymarkedtrails.org">waymarkedtrails.org</a>. CC-SA 3.0'}),overlays={Waymarkedtrails:tilesWayMarkedTrails},iconPoint=L.icon({iconUrl:'icon-walk.png',iconAnchor:[5,5]}),iconCamp=L.icon({iconUrl:'icon-camp.png',iconAnchor:[5,5]}),iconTarget=L.icon({iconUrl:'icon-target.png',iconAnchor:[15,15]}),iconCross=L.icon({iconUrl:'icon-cross.png',iconAnchor:[7,7]});firstfly=!0,flownTo=new Set,ttMilestone=[];const cdtBounds=[[-114,49],[-105,49],[-105,31],[-114,31]],cdtPolygon=[[-113.326252,46.375386],[-114.775113,48.992727],[-114.695734,45.700459],[-113.460733,44.118182],[-107.028708,39.752045],[-108.408835,37.92869],[-107.100957,36.536929],[-108.790538,35.000747],[-108.965692,31.299239],[-107.743995,31.297717],[-107.198116,34.979334],[-105.709069,36.582693],[-105.207683,40.708463],[-111.465271,45.531042],[-112.300283,49.037458],[-114.775113,48.992727]],map=new L.Map('eltmap',{crs:L.CRS.EPSG3857,layers:[tilesOutdoors],continuousWorld:!0,worldCopyJump:!1,zoomControl:!1,attributionControl:!0}),mapCtrlLayers=L.control.layers(basemaps,overlays,{collapsed:!0}).addTo(map);lgPlaces=null,L.control.scale({metric:!0,imperial:!0}).addTo(map);const msgelt=document.getElementById('msgmap');function setInfo(a){msgelt.innerHTML=a}function floatImage(b){const a=1e6;return String(Math.round(b*a)/a)}function latlonImage(a){return floatImage(a.lat)+" "+floatImage(a.lng)}map.on('zoomend',function(b){}),map.on('keypress',function(a){console.log(a),console.log(a.originalEvent.charCode),a.originalEvent.code=='KeyC'&&setInfo('Lat Lon: '+latlonImage(a.latlng))}),map.on('click',a=>{setInfo(`${latlonImage(a.latlng)}  z${map.getZoom()}`)}),control=L.Control.fileLayerLoad({layer:L.geoJson,layerOptions:{style:{color:'black'},filter:function(a){return a.geometry.type=="LineString"}},addToMap:!0,fileSizeLimit:4096,formats:['.geojson','.kml','.gpx']}).addTo(map),control.loader.on('data:loaded',function(a){layerswitcher.addOverlay(a.layer,a.filename)}),zanim=null,map.setView([31.803,-42.367],zanim?1:3);function addGpx(a,d,b={color:'red'}){const c=omnivore.gpx('tracks/'+a,null,L.geoJson(null,{style:function(a){return b},onEachFeature:function(a,c){var b='';a.properties&&a.properties.name&&(b='<strong><center>'+a.properties.name+'</center></strong>'),b!=''&&c.bindTooltip(b,{sticky:!0}),a.geometry.type=='Point'&&c.setIcon(iconCross)}}));return c}function addKml(a,b='blue'){const c=omnivore.kml('tracks/'+a,null,L.geoJson(null,{style:function(a){return{color:a.properties.stroke?'#'+a.properties.stroke:b,opacity:a.properties['stroke-opacity']?a.properties['stroke-opacity']:1,weight:a.properties['stroke-width']?a.properties['stroke-width']:1}},onEachFeature:function(a,c){var b='';a.properties&&a.properties.name&&(b='<strong><center>'+a.properties.name+'</center></strong>'),a.properties&&a.properties.description&&(b=b+'<p>'+a.properties.description+'</p>'),b!=''&&c.bindTooltip(b,{sticky:!0}),a.geometry.type=='Point'&&c.setIcon(iconTarget)}}));return c}function inreachBubble(a){return"<table><tr><td><h6>Time</h6></td><td><h6>"+new Date(a.timestamp).toLocaleString()+"</h6></td></tr>"+"</table>"+(a.Text?"<h5>"+a.Text+"</h5>":"")}function myKmlParse(g,h,f){var b=[],a=null,e=!1,d=new Date,c=L.markerClusterGroup({animate:!0,disableClusteringAtZoom:12}),i=L.geoJson(toGeoJSON.kml(g),options={filter:function(a){return a.geometry.type=='Point'},pointToLayer:function(c,f){b.push([f.lat,f.lng]);const h=new Date(c.properties.timestamp);e=h>d,d.setTime(h.getTime()+5*3600*1e3),a&&e&&(a.setIcon(iconCamp),a.setZIndexOffset(100));var g=null;return c.properties.timestamp?g=new Date(c.properties.timestamp).toLocaleString():g="UTC: "+new Date(c.properties['Time UTC']).toLocaleString(),a=L.marker(f,options={title:g,icon:iconPoint,zIndexOffset:0}),a}});setInfo(b.length+" InReach points "+f),b.length>0&&(mlin=L.polyline(b,{color:'firebrick',weight:2,smoothFactor:2}).bindPopup(h).addTo(c),i.bindPopup(function(a){return inreachBubble(a.feature.properties)}).addTo(c),map.addLayer(c))}async function loadInfos(){var a,d,b,e,f;zanim&&(clearInterval(zanim),zanim=null);const n={radius:1e5,color:'#A8A8A8',weight:1};a=L.featureGroup();const l={lng:2.5509443,lat:49.0080713},h={lng:-114.0101401,lat:51.131069},i={lng:-112.010124,lat:33.435249},m=new L.Geodesic([[l,h],[h,i]],{steps:6,weight:5,opacity:.5}).bindTooltip('CDG to PHX via YYC',{sticky:!0});a.addLayer(m),a.addLayer(addKml('CDG_CrazyCook.kml')),mapCtrlLayers.addOverlay(a,'Going to Crazy Cook'),a.addTo(map),d=addGpx('CDT2023_plan.gpx','The Plan (hopefully)',{color:'DarkOrchid',weight:3,opacity:1}),mapCtrlLayers.addOverlay(d,'The Plan (hopefully)'),d.addTo(map),b=L.featureGroup(null,{attribution:'CDTC'}),ttMilestone=[];const j={color:'red',weight:8,opacity:.7},k=addGpx('CDT_HalfMile_2020.gpx');k.once('ready',function(c){const d=c.target.toGeoJSON(),a=d.features[0].geometry.coordinates.map(a=>[a[1],a[0]]),e=L.polyline(a,j);b.addLayer(e).bindTooltip('The Official "Red Line" CDT',{sticky:!0});const f=map.getZoom(),g=Zoom2Mile[f];for(let b=0;b<a.length;b+=2){const c=b/2,d=L.tooltip(a[b],{content:c.toString(),className:'milestone'});ttMilestone[c]=d}}),mapCtrlLayers.addOverlay(b,'Official CDT Milestones');function c(a){if(a.layer&&a.layer!=b)return;if(map.hasLayer(b)){const a=map.getZoom(),b=Zoom2Mile[a];ttMilestone.forEach((a,c)=>{c%b==0&&map.getBounds().contains(a.getLatLng())?a.addTo(map):a.remove()}),ttMilestone[ttMilestone.length-1].addTo(map)}else ttMilestone.forEach(a=>a.remove())}map.on('zoomend',c),map.on('moveend',c),map.on('overlayadd',c),map.on('overlayremove',c),e=L.featureGroup(null,{attribution:'<a href="https://native-land.ca">native-land.ca</a>'}),fetch('https://native-land.ca/wp-json/nativeland/v1/api/index.php',{method:'POST',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify({maps:'territories',polygon_geojson:{type:'FeatureCollection',features:[{type:'Feature',properties:{},geometry:{type:'Polygon',coordinates:[cdtPolygon]}}]}})}).then(a=>a.json()).then(a=>{const b=L.geoJson({type:'FeatureCollection',features:a},{style:a=>({color:a.properties.color})}).bindPopup(a=>a.feature.properties.Name);setTimeout(function(){e.addLayer(b).addTo(map),mapCtrlLayers.addOverlay(e,'Native Land')},4*1e3)});const g=getParameterByName('days')||30;console.log('days = '+g),f=new Date,f.setTime(Date.now()-g*86400*1e3);const o='https://inreach.garmin.com/Feed/Share/ThierryBernier?d1='+f.toJSON()}function zAnim(){map.zoomIn(1),map.getZoom()>=5&&loadInfos()}zanim||loadInfos();function mapFlyTo(a,b,d){const c=`${a} ${b}`;if(!flownTo.has(c)){flownTo.add(c),lgPlaces==null&&(lgPlaces=L.markerClusterGroup(),mapCtrlLayers.addOverlay(lgPlaces,'Places'));const e=L.circleMarker([a,b],{interactive:!0,radius:8}).bindTooltip(d);lgPlaces.addLayer(e).addTo(map)}const e=firstfly?8:map.getZoom();firstfly=!1,map.setView(L.latLng(a,b),e,{animate:!0,duration:1.5})}