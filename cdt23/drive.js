var activedrive=!0,numPhoto;const homediv=document.getElementById('divphoto');(homediv.style.display=='none'||getParameterByName('tof')=='off')&&(homediv.style.display='none',activedrive=!1);const domtof=document.getElementById('photofeed'),domfly=document.getElementById('photo:autoFlyTo');let tof={};tof.nextPageToken='',tof.files=[];const API_KEY='AIzaSyA1IFKmTOXEHiA5w9QHRNOR64pLTk2ZCSw';function gapiLoaded(){activedrive?(console.log('gapi.load'),gapi.load('client',initializeGapiClient)):console.log('gapi.load  disabled')}async function initializeGapiClient(){console.log('gapi.client.init'),await gapi.client.init({apiKey:API_KEY,discoveryDocs:['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']}),console.log('gapi.client.init-ed'),feedDrive(8)}numPhoto=0;function fileAdd(a){let b=++numPhoto,c='',d='',e='';try{const f=a.imageMediaMetadata.location.latitude,g=a.imageMediaMetadata.location.longitude;e=a.thumbnailLink;const h=`'${a.imageMediaMetadata.time}'`;c=` onmouseover="flyToIf(this,${f.toFixed(6)},${g.toFixed(6)},${b})"`,d=`<center><button disabled="yes">${a.imageMediaMetadata.time}</button></center>`}catch{}return`<hr><div ${c}><a href="${a.webViewLink}" id="photo${b}" target="_blank">`+`<figure><img src="${e}" alt="${a.name}"><figcaption>${d}</figcaption></figure></a></div>`}function fileSub(a,b){try{const c=a.imageMediaMetadata.time,d=b.imageMediaMetadata.time;return c==d?0:c<d?1:-1}catch{}return console.log(`fileSub ${a} ${b} `),1}function onlyUnique(a,b,c){return c.findIndex(b=>b.id==a.id)===b}function flyToIf(d,b,c,a){if(console.log(`flyTo lat,lon=${b},${c} enabled=${domfly.checked} ref=${a}`),domfly.checked){typeof a=='number'&&(a=document.getElementById(`photo${a}`)),a=a.cloneNode(!0);let d=a.querySelector('img');d.src=d.src.replace(/=s[0-9]+$/,'=s512'),mapFlyTo(b,c,a)}}async function feedDrive(a){const b='feedDrive';console.log(`${b}: start ${a}`),done=a!=0;do{const d={q:"'1O_tzaI6HPBCR9AlqRbQqzw4JqzZoqfOv' in parents",corpora:"user",trashed:!1,pageSize:a||32,pageToken:tof.nextPageToken,fields:'nextPageToken,files(id,name,thumbnailLink,webViewLink,imageMediaMetadata)',orderBy:'createdTime desc'};let c;console.log('calling gapi.client.drive');try{c=await gapi.client.drive.files.list(d)}catch(a){console.log(`photo: Error: ${a}`);break}tof.nextPageToken=c.result.nextPageToken,console.log(`${b} nextToken ${tof.nextPageToken}`),tof.nextPageToken&&tof.nextPageToken!=void 0&&tof.nextPageToken!=''?document.getElementById('photomore').innerText='Show more':(document.getElementById('photomore').innerText='Done',tof.nextPageToken='',done=!0),!c.result.files||c.result.files.length==0?(console.log('photo: No files found.'),done=!0):(tof.files.push(...c.result.files),console.log(`${b} got files[${c.result.files.length}], total=${tof.files.length}`)),a==0&&(document.getElementById('photoall').innerText=tof.files.length)}while(!done)tof.files.sort((a,b)=>fileSub(a,b)),tof.files=tof.files.filter(onlyUnique),console.log(`${b} filtered to ${tof.files.length}`),a==0&&(numPhoto=0),domtof.innerHTML=tof.files.reduce((a,b)=>`${a}${fileAdd(b)}`,''),a==0&&(document.getElementById('photoall').innerText=tof.files.length)}function photoUpdate(a){console.log(`photoUpdate ${a}`),feedDrive(a).catch(function(a){console.log(`photo: catch1=${a}`)})}