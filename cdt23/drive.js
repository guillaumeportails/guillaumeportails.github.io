var domtof=document.getElementById("photo:feed"),domdbg=document.getElementById('photo:debug'),domfly=document.getElementById('photo:autoFlyTo'),numPhoto;let tof={};tof.nextPageToken='';const API_KEY='AIzaSyA1IFKmTOXEHiA5w9QHRNOR64pLTk2ZCSw';function gapiLoaded(){console.log('gapi.load'),gapi.load('client',initializeGapiClient)}async function initializeGapiClient(){console.log('gapi.client.init'),await gapi.client.init({apiKey:API_KEY,discoveryDocs:['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']}),console.log('gapi.client.init-ed'),domdbg.innerHTML='initClient feeds'}numPhoto=0;function fileAdd(a){let b=++numPhoto,c='',d='';try{const e=a.imageMediaMetadata.location.latitude,f=a.imageMediaMetadata.location.longitude,g=`'${a.imageMediaMetadata.time}'`;c=` onmouseover="flyToIf(this,${e.toFixed(6)},${f.toFixed(6)},${b})"`,d=`<br><center><button disabled="yes">${a.imageMediaMetadata.time}</button></center>`}catch{}return r='<hr>'+`<a href="${a.webViewLink}" target="_blank" onmouseout="this.firstChild.firstChild.style.borderStyle='none';"${c}>`+`<figure id="photo${b}">`+`<img src="${a.thumbnailLink}" alt="${a.name}">`+`<figcaption>${d}</figcaption>`+'</figure>'+'</a>',r}function flyToIf(d,b,c,a){console.log(`flyTo lat,lon=${b},${c} enabled=${domfly.checked} ref=${a}`),domfly.checked&&(typeof a=='number'&&(a=document.getElementById(`photo${a}`).cloneNode(!0)),d.firstChild.firstChild.style.borderStyle='solid',mapFlyTo(b,c,a))}async function feedDrive(){const b='feedDrive';console.log(`${b}: start`);const d={q:"'1O_tzaI6HPBCR9AlqRbQqzw4JqzZoqfOv' in parents",corpora:"user",trashed:!1,pageSize:4,pageToken:tof.nextPageToken,fields:'nextPageToken,files(name,thumbnailLink,webViewLink,imageMediaMetadata)',orderBy:'createdTime desc'};let c;console.log('calling gapi.client.drive');try{c=await gapi.client.drive.files.list(d)}catch(a){console.log(`Error: ${a}`),domdbg.innerText=a;return}tof.nextPageToken=c.result.nextPageToken,console.log(`${b} nextToken ${tof.nextPageToken}`);const a=c.result.files;if(!a||a.length==0){domdbg.innerText='No files found.';return}console.log(`${b} got files[${a.length}]`),domtof.innerHTML+=a.reduce((a,b)=>`${a}${fileAdd(b)}`,'')}function photoUpdate(){console.log('photoUpdate'),feedDrive().catch(function(a){domdbg.innerText=`catch1=${a}`})}