var activedrive=!0,numPhoto;const homediv=document.getElementById('divphoto');(homediv.style.display=='none'||getParameterByName('tof')=='off')&&(homediv.style.display='none',activedrive=!1);const domtof=document.getElementById('photofeed'),domfly=document.getElementById('photo:autoFlyTo');let tof={};tof.nextPageToken='',tof.files=[];const API_KEY='AIzaSyA1IFKmTOXEHiA5w9QHRNOR64pLTk2ZCSw';function gapiLoaded(){activedrive?(console.log('gapi.load'),gapi.load('client',initializeGapiClient)):console.log('gapi.load  disabled')}async function initializeGapiClient(){console.log('gapi.client.init'),await gapi.client.init({apiKey:API_KEY,discoveryDocs:['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']}),console.log('gapi.client.init-ed'),feedDrive()}numPhoto=0;function fileAdd(a){let b=++numPhoto,c='',d='';try{const e=a.imageMediaMetadata.location.latitude,f=a.imageMediaMetadata.location.longitude,g=`'${a.imageMediaMetadata.time}'`;c=` onmouseover="flyToIf(this,${e.toFixed(6)},${f.toFixed(6)},${b})"`,d=`<center><button disabled="yes">${a.imageMediaMetadata.time}</button></center>`}catch{}return`<hr><div ${c}><a href="${a.webViewLink}" id="photo${b}" target="_blank">`+`<figure><img src="${a.thumbnailLink}" alt="${a.name}"><figcaption>${d}</figcaption></figure></a></div>`}function fileSub(a,b){try{const c=a.imageMediaMetadata.time,d=b.imageMediaMetadata.time;return c==d?0:c<d?1:-1}catch{}return 1}function onlyUnique(a,b,c){return c.findIndex(b=>b.id==a.id)===b}function flyToIf(d,b,c,a){console.log(`flyTo lat,lon=${b},${c} enabled=${domfly.checked} ref=${a}`),domfly.checked&&(typeof a=='number'&&(a=document.getElementById(`photo${a}`).cloneNode(!0)),mapFlyTo(b,c,a))}async function feedDrive(){const b='feedDrive';console.log(`${b}: start`);const c={q:"'1O_tzaI6HPBCR9AlqRbQqzw4JqzZoqfOv' in parents",corpora:"user",trashed:!1,pageSize:8,pageToken:tof.nextPageToken,fields:'nextPageToken,files(id,name,thumbnailLink,webViewLink,imageMediaMetadata)',orderBy:'createdTime desc'};let a;console.log('calling gapi.client.drive');try{a=await gapi.client.drive.files.list(c)}catch(a){console.log(`photo: Error: ${a}`);return}if(tof.nextPageToken=a.result.nextPageToken,console.log(`${b} nextToken ${tof.nextPageToken}`),tof.nextPageToken&&tof.nextPageToken!=''?document.getElementById('photomore').innerText='Show more':(document.getElementById('photomore').innerText='Done',tof.nextPageToken=''),!a.result.files||a.result.files.length==0){console.log('photo: No files found.');return}tof.files.push(...a.result.files),console.log(`${b} got files[${a.result.files.length}], total=${tof.files.length}`),tof.files.sort((a,b)=>fileSub(a,b)),tof.files=tof.files.filter(onlyUnique),console.log(`${b} filtered to ${tof.files.length}`),domtof.innerHTML=tof.files.reduce((a,b)=>`${a}${fileAdd(b)}`,'')}function photoUpdate(){console.log('photoUpdate'),feedDrive().catch(function(a){console.log(`photo: catch1=${a}`)})}