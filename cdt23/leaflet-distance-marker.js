L.DistanceMarkers=L.LayerGroup.extend({initialize:function(k,i,c){var f,y,t,v,A,d,j,a,B,b,z,e,h,q,r,s,p,u,o,w,x,g,n,m,l;c=c||{},f=c.offset||1e3,y=Math.min(i.getMaxZoom(),c.showAll||12),t=c.cssClass||'dist-marker',v=c.iconSize!==void 0?c.iconSize:[12,12],A=c.textFunction||function(b,a,c){return a},d={},j=k,typeof k.getLatLngs=='function'&&(j=k.getLatLngs()),a=L.GeometryUtil.accumulatedLengths(k),B=a.length>0?a[a.length-1]:0,b=0,z=Math.floor(B/f);for(e=1;e<=z;++e){for(h=f*e;b<a.length-1&&a[b]<h;)++b;q=j[b-1],r=j[b],s=L.polyline([q,r]),p=(h-a[b-1])/(a[b]-a[b-1]),u=L.GeometryUtil.interpolateOnLine(i,s,p),o=A.call(this,h,e,f),w=L.divIcon({className:t,html:o,iconSize:v}),x=L.marker(u.latLng,{title:o,icon:w}),g=this._minimumZoomLevelForItem(e,y),d[g]===void 0&&(d[g]=L.layerGroup()),d[g].addLayer(x)}n=0,m=this,l=function(){var b=n,c=n=i.getZoom(),a;if(c>b){for(a=b+1;a<=c;++a)d[a]!==void 0&&m.addLayer(d[a])}else if(c<b)for(a=b;a>c;--a)d[a]!==void 0&&m.removeLayer(d[a])},i.on('zoomend',l),this._layers={},l()},_minimumZoomLevelForItem:function(c,d){for(var b=d,a=c;a>0&&a%2===0;)--b,a=Math.floor(a/2);return b}}),L.Polyline.include({_originalOnAdd:L.Polyline.prototype.onAdd,_originalOnRemove:L.Polyline.prototype.onRemove,addDistanceMarkers:function(){this._map&&this._distanceMarkers&&this._map.addLayer(this._distanceMarkers)},removeDistanceMarkers:function(){this._map&&this._distanceMarkers&&this._map.removeLayer(this._distanceMarkers)},onAdd:function(b){this._originalOnAdd(b);var a=this.options.distanceMarkers||{};this._distanceMarkers===void 0&&this.options.distanceMarkers&&(this._distanceMarkers=new L.DistanceMarkers(this,b,a)),(a.lazy===void 0||a.lazy===!1)&&this.addDistanceMarkers()},onRemove:function(a){this.removeDistanceMarkers(),this._originalOnRemove(a)}})