(function(a){var b;if(typeof define=='function'&&define.amd)define(['leaflet'],a);else if(typeof module!='undefined')b=require('leaflet'),module.exports=a(b);else{if(typeof window.L=='undefined')throw'Leaflet must be loaded first';a(window.L)}})(function(a){"use strict";return a.Polyline._flat=a.LineUtil.isFlat||a.Polyline._flat||function(b){return!a.Util.isArray(b[0])||typeof b[0][0]!='object'&&typeof b[0][0]!='undefined'},a.GeometryUtil=a.extend(a.GeometryUtil||{},{distance:function(a,b,c){return a.latLngToLayerPoint(b).distanceTo(a.latLngToLayerPoint(c))},distanceSegment:function(b,c,d,e){var f=b.latLngToLayerPoint(c),g=b.latLngToLayerPoint(d),h=b.latLngToLayerPoint(e);return a.LineUtil.pointToSegmentDistance(f,g,h)},readableDistance:function(a,c){var d=c!=='imperial',b;return d?a>1e3?b=(a/1e3).toFixed(2)+' km':b=a.toFixed(1)+' m':(a*=1.09361,a>1760?b=(a/1760).toFixed(2)+' miles':b=a.toFixed(1)+' yd'),b},belongsSegment:function(b,c,d,a){a=a===void 0?.2:a;var e=c.distanceTo(d),f=c.distanceTo(b)+b.distanceTo(d)-e;return f/e<a},length:function(c){var b=a.GeometryUtil.accumulatedLengths(c);return b.length>0?b[b.length-1]:0},accumulatedLengths:function(a){var c,d,b,e;if(typeof a.getLatLngs=='function'&&(a=a.getLatLngs()),a.length===0)return[];c=0,d=[0];for(b=0,e=a.length-1;b<e;b++)c+=a[b].distanceTo(a[b+1]),d.push(c);return d},closestOnSegment:function(b,d,e,f){var c=b.getMaxZoom(),g,h,i,j;return c===1/0&&(c=b.getZoom()),g=b.project(d,c),h=b.project(e,c),i=b.project(f,c),j=a.LineUtil.closestPointOnSegment(g,h,i),b.unproject(j,c)},closest:function(j,c,i,l){var e,g=1/0,d=null,b,k,h,f,m,n,o,p;if(c instanceof Array){if(c[0]instanceof Array&&typeof c[0][0]!='number'){for(b=0;b<c.length;b++)f=a.GeometryUtil.closest(j,c[b],i,l),f&&f.distance<g&&(g=f.distance,d=f);return d}if(c[0]instanceof a.LatLng||typeof c[0][0]=='number'||typeof c[0].lat=='number')c=a.polyline(c);else return d}if(!(c instanceof a.Polyline))return d;if(e=JSON.parse(JSON.stringify(c.getLatLngs().slice(0))),c instanceof a.Polygon&&(m=function(b){if(a.Polyline._flat(b))b.push(b[0]);else for(var c=0;c<b.length;c++)m(b[c])},m(e)),!a.Polyline._flat(e)){for(b=0;b<e.length;b++)f=a.GeometryUtil.closest(j,e[b],i,l),f.distance<g&&(g=f.distance,d=f);return d}if(l){for(b=0,k=e.length;b<k;b++)n=e[b],h=a.GeometryUtil.distance(j,i,n),h<g&&(g=h,d=n,d.distance=h);return d}for(b=0,k=e.length;b<k-1;b++)o=e[b],p=e[b+1],h=a.GeometryUtil.distanceSegment(j,i,o,p),h<=g&&(g=h,d=a.GeometryUtil.closestOnSegment(j,i,o,p),d.distance=h);return d},closestLayer:function(i,k,g){for(var e=1/0,h=null,c=null,d=1/0,f=0,l=k.length,b,j;f<l;f++)b=k[f],b instanceof a.LayerGroup?(j=a.GeometryUtil.closestLayer(i,b.getLayers(),g),j.distance<e&&(e=j.distance,h=j)):(typeof b.getLatLng=='function'?(c=b.getLatLng(),d=a.GeometryUtil.distance(i,g,c)):(c=a.GeometryUtil.closest(i,b,g),c&&(d=c.distance)),d<e&&(e=d,h={layer:b,latlng:c,distance:d}));return h},nClosestLayers:function(j,f,i,e){var d,g,b,h,k,c,l;if(e=typeof e=='number'?e:f.length,e<1||f.length<1)return null;d=[];for(h=0,k=f.length;h<k;h++)c=f[h],c instanceof a.LayerGroup?(l=a.GeometryUtil.closestLayer(j,c.getLayers(),i),d.push(l)):(typeof c.getLatLng=='function'?(b=c.getLatLng(),g=a.GeometryUtil.distance(j,i,b)):(b=a.GeometryUtil.closest(j,c,i),b&&(g=b.distance)),d.push({layer:c,latlng:b,distance:g}));return d.sort(function(a,b){return a.distance-b.distance}),d.length>e?d.slice(0,e):d},layersWithin:function(i,j,h,f){var g,b,c,e,k,d,l;f=typeof f=='number'?f:1/0,g=[],b=null,c=0;for(e=0,k=j.length;e<k;e++)d=j[e],typeof d.getLatLng=='function'?(b=d.getLatLng(),c=a.GeometryUtil.distance(i,h,b)):(b=a.GeometryUtil.closest(i,d,h),b&&(c=b.distance)),b&&c<f&&g.push({layer:d,latlng:b,distance:c});return l=g.sort(function(a,b){return a.distance-b.distance}),l},closestLayerSnap:function(f,h,g,c,e){var b,d;return c=typeof c=='number'?c:1/0,e=typeof e!='boolean'||e,b=a.GeometryUtil.closestLayer(f,h,g),!b||b.distance>c?null:(e&&typeof b.layer.getLatLngs=='function'&&(d=a.GeometryUtil.closest(f,b.layer,b.latlng,!0),d.distance<c&&(b.latlng=d,b.distance=a.GeometryUtil.distance(f,d,g))),b)},interpolateOnPointSegment:function(c,d,b){return a.point(c.x*(1-b)+b*d.x,c.y*(1-b)+b*d.y)},interpolateOnLine:function(k,b,j){var n,h,d,m,c,l,f,e,i,g,o,p;if(b=b instanceof a.Polyline?b.getLatLngs():b,n=b.length,n<2)return null;if(j=Math.max(Math.min(j,1),0),j===0)return{latLng:b[0]instanceof a.LatLng?b[0]:a.latLng(b[0]),predecessor:-1};if(j==1)return{latLng:b[b.length-1]instanceof a.LatLng?b[b.length-1]:a.latLng(b[b.length-1]),predecessor:b.length-2};h=k.getMaxZoom(),h===1/0&&(h=k.getZoom()),d=[],m=0;for(c=0;c<n;c++)d[c]=k.project(b[c],h),c>0&&(m+=d[c-1].distanceTo(d[c]));l=m*j,f=0,e=0;for(c=0;e<l;c++)i=d[c],g=d[c+1],f=e,e+=i.distanceTo(g);return i==void 0&&g==void 0&&(i=d[0],g=d[1],c=1),o=e-f!==0?(l-f)/(e-f):0,p=a.GeometryUtil.interpolateOnPointSegment(i,g,o),{latLng:k.unproject(p,h),predecessor:c-1}},locateOnLine:function(k,e,d){var b=e.getLatLngs(),h,f,m,g,j,c,l,i,n;if(d.equals(b[0]))return 0;if(d.equals(b[b.length-1]))return 1;h=a.GeometryUtil.closest(k,e,d,!1),f=a.GeometryUtil.accumulatedLengths(b),m=f[f.length-1],g=0,j=!1;for(c=0,l=b.length-1;c<l;c++)if(i=b[c],n=b[c+1],g=f[c],a.GeometryUtil.belongsSegment(h,i,n,.001)){g+=i.distanceTo(h),j=!0;break}if(!j)throw"Could not interpolate "+d.toString()+" within "+e.toString();return g/m},reverse:function(b){return a.polyline(b.getLatLngs().slice(0).reverse())},extract:function(g,e,c,b){var i,f,d,j,h;return c>b?a.GeometryUtil.extract(g,a.GeometryUtil.reverse(e),1-c,1-b):(c=Math.max(Math.min(c,1),0),b=Math.max(Math.min(b,1),0),i=e.getLatLngs(),f=a.GeometryUtil.interpolateOnLine(g,e,c),d=a.GeometryUtil.interpolateOnLine(g,e,b),c==b)?(j=a.GeometryUtil.interpolateOnLine(g,e,b),[j.latLng]):(f.predecessor==-1&&(f.predecessor=0),d.predecessor==-1&&(d.predecessor=0),h=i.slice(f.predecessor+1,d.predecessor+1),h.unshift(f.latLng),h.push(d.latLng),h)},isBefore:function(c,a){if(!a)return!1;var b=c.getLatLngs(),d=a.getLatLngs();return b[b.length-1].equals(d[0])},isAfter:function(c,a){if(!a)return!1;var d=c.getLatLngs(),b=a.getLatLngs();return d[0].equals(b[b.length-1])},startsAtExtremity:function(d,b){if(!b)return!1;var e=d.getLatLngs(),a=b.getLatLngs(),c=e[0];return c.equals(a[0])||c.equals(a[a.length-1])},computeAngle:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)*180/Math.PI},computeSlope:function(a,b){var c=(b.y-a.y)/(b.x-a.x),d=a.y-c*a.x;return{a:c,b:d}},rotatePoint:function(c,i,g,h){var d=c.getMaxZoom(),e,f,b,j,k;return d===1/0&&(d=c.getZoom()),e=g*Math.PI/180,f=c.project(i,d),b=c.project(h,d),j=Math.cos(e)*(f.x-b.x)-Math.sin(e)*(f.y-b.y)+b.x,k=Math.sin(e)*(f.x-b.x)+Math.cos(e)*(f.y-b.y)+b.y,c.unproject(new a.Point(j,k),d)},bearing:function(d,e){var a=Math.PI/180,h=d.lat*a,c=e.lat*a,f=d.lng*a,g=e.lng*a,i=Math.sin(g-f)*Math.cos(c),j=Math.cos(h)*Math.sin(c)-Math.sin(h)*Math.cos(c)*Math.cos(g-f),b=(Math.atan2(i,j)*180/Math.PI+360)%360;return b>=180?b-360:b},destination:function(o,d,i){d=(d+360)%360;var c=Math.PI/180,f=180/Math.PI,g=6378137,p=o.lng*c,e=o.lat*c,j=d*c,k=Math.sin(e),l=Math.cos(e),m=Math.cos(i/g),n=Math.sin(i/g),h=Math.asin(k*m+l*n*Math.cos(j)),b=p+Math.atan2(Math.sin(j)*n*l,m-k*Math.sin(h));return b=b*f,b=b>180?b-360:b<-180?b+360:b,a.latLng([h*f,b])},angle:function(b,e,f){var c=b.latLngToContainerPoint(e),d=b.latLngToContainerPoint(f),a=Math.atan2(d.y-c.y,d.x-c.x)*180/Math.PI+90;return a+=a<0?360:0,a},destinationOnSegment:function(c,b,d,e){var f=a.GeometryUtil.angle(c,b,d),g=a.GeometryUtil.destination(b,f,e);return a.GeometryUtil.closestOnSegment(c,g,b,d)}}),a.GeometryUtil})